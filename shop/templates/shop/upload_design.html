{% extends 'base.html' %}
{% load widget_tweaks %}
{% load static %}

{% block title %}Upload Custom Design - RHINO.EG{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="text-center mb-5">
        <h1 class="display-4 fw-bold text-prussian-blue mb-3">Create Your Custom Poster</h1>
        <p class="lead text-muted">
            Upload your design, choose your size and frame option, and we'll create a stunning poster just for you!
        </p>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-lg border-0">
                <div class="card-body p-5">
                    <form method="POST" enctype="multipart/form-data" id="customDesignForm">
                        {% csrf_token %}
                        
                        <!-- File Upload Section -->
                        <div class="upload-section mb-5">
                            <h4 class="text-prussian-blue mb-3">Step 1: Upload Your Design</h4>
                            <div class="upload-area border-2 border-dashed border-muted rounded p-5 text-center" id="uploadArea">
                                <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                                <h5 class="text-muted mb-2">Drag & Drop your image here</h5>
                                <p class="text-muted mb-3">or click to browse files</p>
                                {{ form.design_file|add_class:"form-control d-none" }}
                                <button type="button" class="btn btn-outline-prussian-blue" onclick="document.getElementById('id_design_file').click()">
                                    Choose File
                                </button>
                                <div class="mt-3">
                                    <small class="text-muted">Supported formats: JPG, PNG, PDF (Max 10MB)</small>
                                </div>
                            </div>
                            <div id="filePreview" class="mt-3 d-none">
                                <div class="preview-container text-center">
                                    <img id="previewImage" class="img-fluid rounded shadow-sm" style="max-height: 200px;">
                                    <div class="mt-2">
                                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeFile()">
                                            Remove File
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Customization Options -->
                        <div class="customization-section mb-5">
                            <h4 class="text-prussian-blue mb-3">Step 2: Choose Your Options</h4>
                            
                            <!-- Size Selection -->
                            <div class="mb-4">
                                <label class="form-label fw-bold">Poster Size</label>
                                {{ form.size|add_class:"form-select form-select-lg" }}
                            </div>

                            <!-- Frame Option -->
                            <div class="mb-4">
                                <label class="form-label fw-bold">Frame Option</label>
                                <div class="frame-options">
                                    <div class="form-check frame-option-card p-3 border rounded mb-2">
                                        <input class="form-check-input" type="radio" name="framed" id="frameless" value="False" checked>
                                        <label class="form-check-label w-100" for="frameless">
                                            <div class="d-flex align-items-center">
                                                <i class="fas fa-square fa-2x text-muted me-3"></i>
                                                <div>
                                                    <h6 class="mb-1">Frameless</h6>
                                                    <small class="text-muted">Clean & modern look</small>
                                                </div>
                                            </div>
                                        </label>
                                    </div>
                                    <div class="form-check frame-option-card p-3 border rounded">
                                        <input class="form-check-input" type="radio" name="framed" id="framed" value="True">
                                        <label class="form-check-label w-100" for="framed">
                                            <div class="d-flex align-items-center">
                                                <i class="fas fa-border-style fa-2x text-ut-orange me-3"></i>
                                                <div>
                                                    <h6 class="mb-1">Framed</h6>
                                                    <small class="text-muted">Black wood frame (+70 LE)</small>
                                                </div>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Contact Information -->
                        <div class="contact-section mb-5">
                            <h4 class="text-prussian-blue mb-3">Step 3: Contact Information</h4>
                            <div class="row">
                                <div class="col-md-6">
                                    <label class="form-label fw-bold">Phone Number</label>
                                    {{ form.phone_number|add_class:"form-control form-control-lg" }}
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-bold">Additional Notes (Optional)</label>
                                    {{ form.notes|add_class:"form-control" }}
                                </div>
                            </div>
                        </div>

                        <!-- Price Preview -->
                        <div class="price-preview bg-light p-4 rounded mb-4">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <h5 class="text-prussian-blue mb-2">Your Custom Poster</h5>
                                    <p class="text-muted mb-0" id="orderSummary">
                                        A4 • Frameless
                                    </p>
                                </div>
                                <div class="col-md-4 text-end">
                                    <h4 class="text-ut-orange fw-bold mb-0" id="priceDisplay">30 LE</h4>
                                    <small class="text-muted">+ 50 LE shipping</small>
                                </div>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="text-center">
                            <button type="submit" class="btn btn-ut-orange btn-lg px-5">
                                <i class="fas fa-magic me-2"></i>
                                Create My Poster
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// File upload preview
document.getElementById('id_design_file').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('previewImage').src = e.target.result;
            document.getElementById('filePreview').classList.remove('d-none');
        };
        reader.readAsDataURL(file);
    }
});

// Frame option selection
document.querySelectorAll('input[name="framed"]').forEach(radio => {
    radio.addEventListener('change', function() {
        updateOrderSummary();
    });
});

// Size selection
document.getElementById('id_size').addEventListener('change', function() {
    updateOrderSummary();
});

function updateOrderSummary() {
    const framed = document.querySelector('input[name="framed"]:checked').value === 'True';
    const size = document.getElementById('id_size').value;
    
    const sizeText = size;
    const frameText = framed ? 'Framed' : 'Frameless';
    
    document.getElementById('orderSummary').textContent = `${sizeText} • ${frameText}`;
    
    // Update price
    const basePrices = {
        'A5': 25,
        'A4': 30,
        'A3': 35,
    };
    
    let price = basePrices[size] || 30;
    
    // Add frame cost if framed
    if (framed) {
        price += 70;
    }
    
    document.getElementById('priceDisplay').textContent = `${price} LE`;
}

function removeFile() {
    document.getElementById('id_design_file').value = '';
    document.getElementById('filePreview').classList.add('d-none');
}

// Initialize
updateOrderSummary();
</script>
{% endblock %}
